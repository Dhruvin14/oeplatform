{% extends "base/base.html" %}
{% load bootstrap3 %}
{% load staticfiles %}
{% load modelview_extras %}
{% block after-header %}
<link rel="stylesheet" href="{% static 'css/mv-style.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
{% endblock %}

{% block content-right %}
    {% if label == 'Model' %}

    {% elif label == 'Framework'  %}

    {% elif label == 'Scenario' %}

    {% endif %}
{% endblock %}

{% block content %}
<h3>{{label}} Factsheets</h3>

<script type="text/javascript">

</script>

<div>
    <div class="checkbox-container">
    {% for heading,d in fields.items %}
        <div class="checkbox-item">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a class="fill-div" data-toggle="collapse" href="#{{heading.split|join:'_'}}">{{heading}}</a>
              </h4>
            </div>

            <div id="{{heading.split|join:'_'}}" class="panel-collapse collapse">
                <table class="table">
                    {% for key,value in d.items %}
                        <tr>
                            <th><label for="{{key}}">{{key}}</label></th>
                            <td><input type="checkbox" onchange="apply_filter(event)" id="{{key}}"></td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    {% endfor %}
    </div>
</div>

{% if label == 'Model' %}
    <table id="overview" class="display">
    </table>

    <script>
    var dt;

    var full_data = [
        {% for model in models %}
            {
                {% for d in fields.values %}

                    {% for group in d.values %}
                        {% for field in group %}
                            {{ field }}: {{model|get_model_value:field}},
                        {% endfor %}
                    {% endfor %}

                {% endfor %}
            },
        {% endfor %}
    ]

    var all_columns = [
        {% for d in fields.values %}
            {% for l, group in d.items %}
                    {% for field in group %}
                        {data: '{{ field }}', name: '{{ field }}', title: '{{ field|white_out:'_' }}'},
                    {% endfor %}
            {% endfor %}
        {% endfor %}
    ];

    var fields = {
        {% for d in fields.values %}
            {% for l, group in d.items %}
                '{{ l }}' : [
                    {% for field in group %}
                        '{{ field }}',
                    {% endfor %}
                ],
            {% endfor %}
        {% endfor %}
    };

    var active_columns = [];

    var apply_filter = function (event){
        var sender = event.target;
        for (var i in fields[sender.id]) {
            var property = fields[sender.id][i]
            console.log(property);
            var column = dt.column(property+':name')
            debugger;
            column.visible( ! column.visible() );
        }


    }

    $(document).ready( function () {
        dt = $('#overview').DataTable( {data: full_data, columns: all_columns});
    } );
    </script>
{% elif label == 'Framework'  %}

{% elif label == 'Scenario' %}

{% endif %}



<br><a class="btn btn-info" href="add">New</a>
{% endblock %}
