{% extends "dataedit/base.html" %}

{% block data_content %}

{% load staticfiles %}
{% load bootstrap3 %}

<div class="tagcontainer">
    {% load dataedit.taghandler %}
    {% get_tags as all_tags %}

    {% for tag in tags %}
        <a href="" class="btn tag" style="background:{{tag.color}}">{{ tag.label }}</a>
    {% endfor %}

    {% load dataedit.taghandler %}
    {% get_tags as all_tags %}

    <button data-toggle="collapse"  data-target="#tag_handler" class="btn btn-add btn-circle glyphicon glyphicon-plus">
    </button>
    <div id="tag_handler" class="collapse">
        <form action="{{table}}/tags/add/" method="post">
            {% csrf_token %}
            <h4>Choose tags for this table:</h4>

            {% for tag in all_tags %}
                <span  >
                    <input type="checkbox" class="hidden" name="{{tag.pk}}" id="select_{{tag.pk}}" {% if tag in tags %} checked {% endif %}>
                    <label style="background:{{tag.color}}" class="btn tag" for="select_{{tag.pk}}">{{tag.label}}</label>
                </span>
            {% endfor %}
            <input type="submit" class="btn btn-success">
        </form>
    </div>
</div>

<hr>


<link rel="stylesheet" href="{% static 'dataedit/dataedit.css' %}">
<script type="text/javascript" src="{% static 'dataedit/views.js' %}"></script>

<!-- you do not have to use bootstrap but we use it by default -->
<link rel="stylesheet" href="{% static 'dataedit/recline/vendor/bootstrap/3.2.0/css/bootstrap.css' %}">
<!-- vendor css -->
<link href="{% static 'dataedit/recline/vendor/leaflet/0.7.3/leaflet.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/vendor/leaflet.markercluster/MarkerCluster.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/vendor/leaflet.markercluster/MarkerCluster.Default.css' %}" rel=
  "stylesheet">
<link rel="stylesheet" href="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.grid.css' %}">

<!-- recline css -->
<link href="{% static 'dataedit/recline/css/map.css' %}" rel="stylesheet">

<link href="{% static 'dataedit/recline/css/multiview.css' %}" rel="stylesheet">
<link href="{% static 'dataedit/recline/css/slickgrid.css' %}"rel="stylesheet">
<link href="{% static 'dataedit/recline/css/flot.css' %}" rel="stylesheet">

<!-- Vendor JS - general dependencies -->
<script src="{% static 'dataedit/recline/vendor/jquery/1.7.1/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/underscore/1.4.4/underscore.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/backbone/1.0.0/backbone.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/mustache/0.5.0-dev/mustache.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/bootstrap/3.2.0/js/bootstrap.js' %}" type="text/javascript"></script>

<!-- Vendor JS - view dependencies -->
<script src="{% static 'dataedit/recline/vendor/leaflet/0.7.3/leaflet.js' %}" type="text/javascript"></script>
<script src="{% static 'dataedit/recline/vendor/leaflet.markercluster/leaflet.markercluster.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/flot/jquery.flot.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/flot/jquery.flot.time.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/moment/2.0.0/moment.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/jquery-ui-1.8.16.custom.min.js' %}"></script>
<script src="{% static 'dataedit/recline/vendor/slickgrid/2.2/jquery.event.drag-2.2.js' %}"></script>
<script src="{% static 'dataedit/recline/vendor/slickgrid/2.2/jquery.event.drop-2.2.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.core.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.formatters.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.editors.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/slick.grid.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/plugins/slick.rowselectionmodel.js' %}"></script>
<script type="text/javascript" src="{% static 'dataedit/recline/vendor/slickgrid/2.2/plugins/slick.rowmovemanager.js' %}"></script>

<!-- Recline JS (combined distribution, all views) -->
<script src="{% static 'dataedit/recline/dist/recline.js' %}" type="text/javascript"></script>

<script src="{% static 'dataedit/backend.js' %}" type="text/javascript"></script>


<script type="text/javascript">
        var dataset = new recline.Model.Dataset({
            table: '{{table}}',
            schema: '{{schema}}',
            backend: 'OEP',
            has_row_comments: {% if has_row_comments %} true {% else %} false {% endif %}
        });

        dataset.fetch().done(function(dataset) {
            console.log('records: ' + dataset.records);
});
</script>

<div class="container">
  <style type="text/css">
    .recline-slickgrid {
      min-height: 700px;
    }

    .changelog {
      display: none;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
    }
  </style>

  <div class="changelog">
    <h3>Changes</h3>
  </div>

  <div class="data-explorer-here"></div>
  <div style="clear: both;"></div>
    Data is displayed using <a href="http://okfnlabs.org/recline/">recline.js</a>
</div>

<script type="text/javascript">

    var createMultiView = function(dataset, state) {
        // remove existing multiview if present
        var reload = false;
        if (window.multiView) {
        window.multiView.remove();
        window.multiView = null;
        reload = true;
    }

    var $el = $('<div />');
    $el.appendTo(window.explorerDiv);

    {# {% if '_comment' in header %} handle_comment_field(dataset, recline, {{ header.index('_comment') }}); {% endif %} #}

    var views = [
       {% if 'table' in kinds %}
           {
              view: new recline.View.SlickGrid({model: dataset}),
              label: 'Grid',
              id: 'Grid'
           },
        {% endif %}
        {% if 'map' in kinds %}
            {
                view: new recline.View.Map({model: dataset}),
                label: 'Map',
                id: 'map'
            },
        {% endif %}
            {
                view: new recline.View.Graph({model: dataset}),
                label: 'Graph',
                id: 'graph'
            },
    ];
    var multiView = new recline.View.MultiView({
    model: dataset,
    el: $el,
    state: state,
    views: views
});
return multiView;
}

jQuery(function($) {
    window.multiView = null;
    window.explorerDiv = $('.data-explorer-here');

    // create the demo dataset
    window.multiview = createMultiView(dataset);

});
</script>
    <a href="?page=1"> first </a>
{% for p in pages %}
    {% if p == page %}
        {{p }}
    {% else %}
        <a href="?page={{p}}">{{p}}</a>
    {% endif %}
{% endfor %} <a href="?page={{ page_num }}"> last </a>
<div>
    <table class="table table-hover" style="width:460px">
        <tr>
            <th>Name</th>
            <td>{{comment_on_table.Name}}</td>
        </tr>
        {% if comment_on_table.Source %}
        <tr>
            <th>Sources</th>
            <ul>
            {% for source in comment_on_table.Source %}
                <li> <a href="{{source.URL}}">{{source.Name }}</a></li>
            {% endfor %}
            </ul>
        </tr>
        {% endif %}
        {% if comment_on_table.Reference_date %}
        <tr>
            <th>Reference date</th>
            <td>
            {% for ref in comment_on_table.Reference_date %}
                {{ref}}{% if not forloop.last %}, {% endif %}
            {% endfor %}</td>
        </tr>
        {% endif %}
        {% if comment_on_table.Date_of_collection %}

        <tr>
            <th>Date of Collection</th>
            <td>
            {% for ref in comment_on_table.Date_of_collection %}
                {{ref}}{% if not forloop.last %}, {% endif %}
            {% endfor %}</td>
        </tr>
        {% endif %}
        {% if comment_on_table.Spatial_resolution %}
        <tr>
            <th>Spatial resolution</th>
            <td>
            {% for ref in comment_on_table.Spatial_resolution %}
                {{ref}}{% if not forloop.last %}, {% endif %}
            {% endfor %}</td>
        </tr>
        {% endif %}
        {% if comment_on_table.Description %}
        <tr>
            <th>Description</th>
            <td>
                <ul>
            {% for ref in comment_on_table.Description %}
               <li> {{ref}}</li>
            {% endfor %}</ul></td>
        </tr>
        {% endif %}
        {% if comment_on_table.Licence %}
        <tr>
            <th>Licence</th>
            <ul>
            {% for source in comment_on_table.Licence %}
                <li> <a href="{{source.URL}}">{{source.Name }}</a></li>
            {% endfor %}
            </ul>
        </tr>
        {% endif %}
    </table>
</div>
<div id="downloadables">
        <div id="revisions" style="width:460px">
            <table class="table table-hover">
                <tr>
                    <th> Revision </th>
                    <th> Created </th>
                    <th> Last Access </th>
                    <th> Available </th>
                </tr>
                {% for entry, av in revisions %}

                <tr>
                    <td> {{ entry.revision }} </td>
                     <td>
                    {% if av %}
                        {{ av.created }}
                    {% else %}
                        -
                    {% endif %}
                    </td>
                    <td>
                    {% if av %}
                        {{ av.last_accessed }}
                    {% else %}
                        -
                    {% endif %}
                    </td>
                    <td>
                    {% if av %}
                        <a href="{{table}}/{{ entry.revision}}"style="color:green;" class='glyphicon glyphicon-ok'></a>
                    {% else %}
                        <a href="{{table}}/{{entry.revision}}"style="color:red;" class='glyphicon glyphicon-remove'></a>
                    {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

{% endblock %}
